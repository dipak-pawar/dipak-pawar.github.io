<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Sparse File | Dipak Pawar</title><meta name=keywords content="TIL,linux,storage"><meta name=description content="Do you know that we can fake the size of file? Yes, you read it correctly. We can fake the size of file. In this article, will focus on sparse files & more details about it.
What&rsquo;s a sparse file? From Wikipedia:
In computer science, a sparse file is a type of computer file that attempts to use file system space more efficiently when the file itself is partially empty. This is achieved by writing brief information (metadata) representing the empty blocks to disk instead of the actual &ldquo;empty&rdquo; space which makes up the block, using less disk space."><meta name=author content="Dipak Pawar"><link rel=canonical href=https://dipak-pawar.github.io/posts/sparse-file/><link crossorigin=anonymous href=/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as=style><link rel=preload href=/logo.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://dipak-pawar.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://dipak-pawar.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://dipak-pawar.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://dipak-pawar.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://dipak-pawar.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="Sparse File"><meta property="og:description" content="Do you know that we can fake the size of file? Yes, you read it correctly. We can fake the size of file. In this article, will focus on sparse files & more details about it.
What&rsquo;s a sparse file? From Wikipedia:
In computer science, a sparse file is a type of computer file that attempts to use file system space more efficiently when the file itself is partially empty. This is achieved by writing brief information (metadata) representing the empty blocks to disk instead of the actual &ldquo;empty&rdquo; space which makes up the block, using less disk space."><meta property="og:type" content="article"><meta property="og:url" content="https://dipak-pawar.github.io/posts/sparse-file/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-22T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-22T00:00:00+00:00"><meta property="og:site_name" content="Dipak Pawar"><meta name=twitter:card content="summary"><meta name=twitter:title content="Sparse File"><meta name=twitter:description content="Do you know that we can fake the size of file? Yes, you read it correctly. We can fake the size of file. In this article, will focus on sparse files & more details about it.
What&rsquo;s a sparse file? From Wikipedia:
In computer science, a sparse file is a type of computer file that attempts to use file system space more efficiently when the file itself is partially empty. This is achieved by writing brief information (metadata) representing the empty blocks to disk instead of the actual &ldquo;empty&rdquo; space which makes up the block, using less disk space."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dipak-pawar.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Sparse File","item":"https://dipak-pawar.github.io/posts/sparse-file/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Sparse File","name":"Sparse File","description":"Do you know that we can fake the size of file? Yes, you read it correctly. We can fake the size of file. In this article, will focus on sparse files \u0026amp; more details about it.\nWhat\u0026rsquo;s a sparse file? From Wikipedia:\nIn computer science, a sparse file is a type of computer file that attempts to use file system space more efficiently when the file itself is partially empty. This is achieved by writing brief information (metadata) representing the empty blocks to disk instead of the actual \u0026ldquo;empty\u0026rdquo; space which makes up the block, using less disk space.","keywords":["TIL","linux","storage"],"articleBody":"Do you know that we can fake the size of file? Yes, you read it correctly. We can fake the size of file. In this article, will focus on sparse files \u0026 more details about it.\nWhat’s a sparse file? From Wikipedia:\nIn computer science, a sparse file is a type of computer file that attempts to use file system space more efficiently when the file itself is partially empty. This is achieved by writing brief information (metadata) representing the empty blocks to disk instead of the actual “empty” space which makes up the block, using less disk space. The full block size is written to disk as the actual size only when the block contains “real” (non-empty) data.\nFiles having blocks which contains zero, but not stored on disk are sparse files. So If we have 10 GB of sparse file, it’s not going to take less space on filesystem assuming it has zero blocks.\nWhy When, we have limited disk space \u0026 need to allocate space for multiple users/programs which never fills that space completely e.g. virtual machine.\nIf virtual machine never fills the disk, then certain amount of disk will have zeros in it. Sparse files permits us to save disk space in this.\nHow Sparse files doesn’t store the zeros on disk, instead it stores metadata describing zeros which can be generated.\nWhen reading sparse files, the filesystem converts metadata representing zeros into real blocks filled with null bytes at runtime.\nCreate Sparse File # create sparse file using truncate [dipak@localhost ~]$ truncate -s 100MiB /tmp/sparse-file or # create sparse file using dd [dipak@localhost ~]$ dd of=/tmp/sparse-file bs=10M seek=10 count=0 0+0 records in 0+0 records out 0 bytes copied, 0.000121888 s, 0.0 kB/s # check occupied space [dipak@localhost ~]$ ls -als /tmp/sparse-file 0 -rw-rw-r--. 1 dipak dipak 104857600 Jun 18 22:46 /tmp/sparse-file or [dipak@localhost ~]$ du -hs /tmp/sparse-file 0\t/tmp/sparse-file Convert existing file into sparse On Linux, an existing file can be converted to sparse by: fallocate -d \n# create file using dd [dipak@localhost ~]$ dd if=/dev/zero of=/tmp/output bs=100M count=4 4+0 records in 4+0 records out 419430400 bytes (419 MB, 400 MiB) copied, 0.193488 s, 2.2 GB/s # check occupied space [dipak@localhost ~]$ stat /tmp/output File: /tmp/output Size: 419430400 Blocks: 819200 IO Block: 4096 regular file Device: 31h/49d\tInode: 2957 Links: 1 Access: (0664/-rw-rw-r--) Uid: ( 1000/ dipak) Gid: ( 1000/ dipak) Context: unconfined_u:object_r:user_tmp_t:s0 Access: 2021-06-18 23:03:20.745563236 +0530 Modify: 2021-06-18 23:03:20.008545895 +0530 Change: 2021-06-18 23:03:20.008545895 +0530 Birth: - # covert to sparse files [dipak@localhost ~]$ fallocate -d /tmp/output # check occupied space [dipak@localhost ~]$ fallocate -d /tmp/output [dipak@localhost ~]$ stat /tmp/output File: /tmp/output Size: 419430400 Blocks: 0 IO Block: 4096 regular file Device: 31h/49d\tInode: 2957 Links: 1 Access: (0664/-rw-rw-r--) Uid: ( 1000/ dipak) Gid: ( 1000/ dipak) Context: unconfined_u:object_r:user_tmp_t:s0 Access: 2021-06-18 23:04:22.349012691 +0530 Modify: 2021-06-18 23:04:22.284011162 +0530 Change: 2021-06-18 23:04:22.284011162 +0530 Birth: - The the number of blocks now is 0 as the blocks with empty bytes were de-allocated. Note that size remains the same which is logical size of file, not it’s size on disk.\n","wordCount":"512","inLanguage":"en","datePublished":"2021-05-22T00:00:00Z","dateModified":"2021-05-22T00:00:00Z","author":{"@type":"Person","name":"Dipak Pawar"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dipak-pawar.github.io/posts/sparse-file/"},"publisher":{"@type":"Organization","name":"Dipak Pawar","logo":{"@type":"ImageObject","url":"https://dipak-pawar.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://dipak-pawar.github.io/ accesskey=h title="Dipak's Blog (Alt + H)"><img src=/logo.png alt=logo aria-label=logo height=40>Dipak's Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://dipak-pawar.github.io/about/ title=About><span>About</span></a></li><li><a href=https://dipak-pawar.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://dipak-pawar.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://dipak-pawar.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Sparse File</h1><div class=post-meta>May 22, 2021&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Dipak Pawar&nbsp;|&nbsp;<a href=https://github.com/dipak-pawar/dipak-pawar.github.io/content/posts/sparse-file.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#whats-a-sparse-file aria-label="What&amp;rsquo;s a sparse file?">What&rsquo;s a sparse file?</a></li><li><a href=#why aria-label=Why>Why</a></li><li><a href=#how aria-label=How>How</a><ul><li><a href=#create-sparse-file aria-label="Create Sparse File">Create Sparse File</a></li><li><a href=#convert-existing-file-into-sparse aria-label="Convert existing file into sparse">Convert existing file into sparse</a></li></ul></li></ul></div></details></div><div class=post-content><p><em>Do you know that we can fake the size of file?</em> Yes, you read it correctly. We can fake the size of file. In this article, will focus on <em>sparse files</em> & more details about it.</p><h3 id=whats-a-sparse-file>What&rsquo;s a sparse file?<a hidden class=anchor aria-hidden=true href=#whats-a-sparse-file>#</a></h3><p>From Wikipedia:</p><p><em>In computer science, a sparse file is a type of computer file that attempts to use file system space more efficiently when the file itself is partially empty. This is achieved by writing brief information (metadata) representing the empty blocks to disk instead of the actual &ldquo;empty&rdquo; space which makes up the block, using less disk space. The full block size is written to disk as the actual size only when the block contains &ldquo;real&rdquo; (non-empty) data.</em></p><p>Files having blocks which contains zero, but not stored on disk are sparse files. So If we have 10 GB of sparse file, it&rsquo;s not going to take less space on filesystem assuming it has zero blocks.</p><h3 id=why>Why<a hidden class=anchor aria-hidden=true href=#why>#</a></h3><p>When, we have limited disk space & need to allocate space for multiple users/programs which never fills that space completely e.g. virtual machine.</p><p>If virtual machine never fills the disk, then certain amount of disk will have zeros in it. Sparse files permits us to save disk space in this.</p><h3 id=how>How<a hidden class=anchor aria-hidden=true href=#how>#</a></h3><p>Sparse files doesn&rsquo;t store the zeros on disk, instead it stores metadata describing zeros which can be generated.</p><p>When reading sparse files, the filesystem converts metadata representing zeros into real blocks filled with null bytes at runtime.</p><h4 id=create-sparse-file>Create Sparse File<a hidden class=anchor aria-hidden=true href=#create-sparse-file>#</a></h4><pre><code># create sparse file using truncate
[dipak@localhost ~]$ truncate -s 100MiB /tmp/sparse-file

or

# create sparse file using dd
[dipak@localhost ~]$ dd of=/tmp/sparse-file bs=10M seek=10 count=0
0+0 records in
0+0 records out
0 bytes copied, 0.000121888 s, 0.0 kB/s

# check occupied space
[dipak@localhost ~]$ ls -als /tmp/sparse-file
0 -rw-rw-r--. 1 dipak dipak 104857600 Jun 18 22:46 /tmp/sparse-file

or

[dipak@localhost ~]$ du -hs /tmp/sparse-file
0	/tmp/sparse-file

</code></pre><h4 id=convert-existing-file-into-sparse>Convert existing file into sparse<a hidden class=anchor aria-hidden=true href=#convert-existing-file-into-sparse>#</a></h4><p>On Linux, an existing file can be converted to sparse by: <code>fallocate -d &lt;filename></code></p><pre><code># create file using dd
[dipak@localhost ~]$ dd if=/dev/zero of=/tmp/output bs=100M count=4
4+0 records in
4+0 records out
419430400 bytes (419 MB, 400 MiB) copied, 0.193488 s, 2.2 GB/s

# check occupied space
[dipak@localhost ~]$ stat /tmp/output
  File: /tmp/output
  Size: 419430400 	Blocks: 819200     IO Block: 4096   regular file
Device: 31h/49d	Inode: 2957        Links: 1
Access: (0664/-rw-rw-r--)  Uid: ( 1000/   dipak)   Gid: ( 1000/   dipak)
Context: unconfined_u:object_r:user_tmp_t:s0
Access: 2021-06-18 23:03:20.745563236 +0530
Modify: 2021-06-18 23:03:20.008545895 +0530
Change: 2021-06-18 23:03:20.008545895 +0530
 Birth: -

# covert to sparse files
[dipak@localhost ~]$ fallocate -d /tmp/output

# check occupied space
[dipak@localhost ~]$ fallocate -d /tmp/output
[dipak@localhost ~]$ stat /tmp/output
  File: /tmp/output
  Size: 419430400 	Blocks: 0          IO Block: 4096   regular file
Device: 31h/49d	Inode: 2957        Links: 1
Access: (0664/-rw-rw-r--)  Uid: ( 1000/   dipak)   Gid: ( 1000/   dipak)
Context: unconfined_u:object_r:user_tmp_t:s0
Access: 2021-06-18 23:04:22.349012691 +0530
Modify: 2021-06-18 23:04:22.284011162 +0530
Change: 2021-06-18 23:04:22.284011162 +0530
 Birth: -
</code></pre><p>The the number of blocks now is 0 as the blocks with empty bytes were de-allocated. Note that size remains the same which is logical size of file, not it&rsquo;s size on disk.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dipak-pawar.github.io/tags/til/>TIL</a></li><li><a href=https://dipak-pawar.github.io/tags/linux/>linux</a></li><li><a href=https://dipak-pawar.github.io/tags/storage/>storage</a></li></ul><nav class=paginav><a class=next href=https://dipak-pawar.github.io/posts/disk-partitioning/><span class=title>Next Page »</span><br><span>Disk Partitioning</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://dipak-pawar.github.io/>Dipak Pawar</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>